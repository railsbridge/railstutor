<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Query</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Query</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/query_rb.html">
                app/models/query.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                ActiveRecord::Base
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000522">add_filter</a>&nbsp;&nbsp;
      <a href="#M000523">add_short_filter</a>&nbsp;&nbsp;
      <a href="#M000518">after_initialize</a>&nbsp;&nbsp;
      <a href="#M000528">available_columns</a>&nbsp;&nbsp;
      <a href="#M000521">available_filters</a>&nbsp;&nbsp;
      <a href="#M000531">column_names=</a>&nbsp;&nbsp;
      <a href="#M000530">columns</a>&nbsp;&nbsp;
      <a href="#M000520">editable_by?</a>&nbsp;&nbsp;
      <a href="#M000540">group_by_column</a>&nbsp;&nbsp;
      <a href="#M000538">group_by_sort_order</a>&nbsp;&nbsp;
      <a href="#M000529">groupable_columns</a>&nbsp;&nbsp;
      <a href="#M000539">grouped?</a>&nbsp;&nbsp;
      <a href="#M000532">has_column?</a>&nbsp;&nbsp;
      <a href="#M000533">has_default_columns?</a>&nbsp;&nbsp;
      <a href="#M000524">has_filter?</a>&nbsp;&nbsp;
      <a href="#M000527">label_for</a>&nbsp;&nbsp;
      <a href="#M000517">new</a>&nbsp;&nbsp;
      <a href="#M000525">operator_for</a>&nbsp;&nbsp;
      <a href="#M000541">project_statement</a>&nbsp;&nbsp;
      <a href="#M000535">sort_criteria</a>&nbsp;&nbsp;
      <a href="#M000534">sort_criteria=</a>&nbsp;&nbsp;
      <a href="#M000536">sort_criteria_key</a>&nbsp;&nbsp;
      <a href="#M000537">sort_criteria_order</a>&nbsp;&nbsp;
      <a href="#M000542">statement</a>&nbsp;&nbsp;
      <a href="#M000519">validate</a>&nbsp;&nbsp;
      <a href="#M000526">values_for</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000517" class="method-detail">
        <a name="M000517"></a>

        <div class="method-heading">
          <a href="#M000517" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(attributes = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000517-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000517-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 120</span>
120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">attributes</span> = <span class="ruby-keyword kw">nil</span>)
121:     <span class="ruby-keyword kw">super</span> <span class="ruby-identifier">attributes</span>
122:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filters</span> <span class="ruby-operator">||=</span> { <span class="ruby-value str">'status_id'</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;o&quot;</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;&quot;</span>]} }
123:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000522" class="method-detail">
        <a name="M000522"></a>

        <div class="method-heading">
          <a href="#M000522" class="method-signature">
          <span class="method-name">add_filter</span><span class="method-args">(field, operator, values)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000522-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000522-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">values</span>)
199:     <span class="ruby-comment cmt"># values must be an array</span>
200:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">values</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Array</span> <span class="ruby-comment cmt"># and !values.first.empty?</span>
201:     <span class="ruby-comment cmt"># check if field is defined as an available filter</span>
202:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">available_filters</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">field</span>
203:       <span class="ruby-identifier">filter_options</span> = <span class="ruby-identifier">available_filters</span>[<span class="ruby-identifier">field</span>]
204:       <span class="ruby-comment cmt"># check if operator is allowed for that filter</span>
205:       <span class="ruby-comment cmt">#if @@operators_by_filter_type[filter_options[:type]].include? operator</span>
206:       <span class="ruby-comment cmt">#  allowed_values = values &amp; ([&quot;&quot;] + (filter_options[:values] || []).collect {|val| val[1]})</span>
207:       <span class="ruby-comment cmt">#  filters[field] = {:operator =&gt; operator, :values =&gt; allowed_values } if (allowed_values.first and !allowed_values.first.empty?) or [&quot;o&quot;, &quot;c&quot;, &quot;!*&quot;, &quot;*&quot;, &quot;t&quot;].include? operator</span>
208:       <span class="ruby-comment cmt">#end</span>
209:       <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">field</span>] = {<span class="ruby-identifier">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">values</span> }
210:     <span class="ruby-keyword kw">end</span>
211:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000523" class="method-detail">
        <a name="M000523"></a>

        <div class="method-heading">
          <a href="#M000523" class="method-signature">
          <span class="method-name">add_short_filter</span><span class="method-args">(field, expression)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000523-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000523-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 213</span>
213:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_short_filter</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">expression</span>)
214:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">expression</span>
215:     <span class="ruby-identifier">parms</span> = <span class="ruby-identifier">expression</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/^(o|c|\!|\*)?(.*)$/</span>).<span class="ruby-identifier">first</span>
216:     <span class="ruby-identifier">add_filter</span> <span class="ruby-identifier">field</span>, (<span class="ruby-identifier">parms</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;=&quot;</span>), [<span class="ruby-identifier">parms</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>]
217:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000518" class="method-detail">
        <a name="M000518"></a>

        <div class="method-heading">
          <a href="#M000518" class="method-signature">
          <span class="method-name">after_initialize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000518-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000518-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 125</span>
125:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_initialize</span>
126:     <span class="ruby-comment cmt"># Store the fact that project is nil (used in #editable_by?)</span>
127:     <span class="ruby-ivar">@is_for_all</span> = <span class="ruby-identifier">project</span>.<span class="ruby-identifier">nil?</span>
128:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000528" class="method-detail">
        <a name="M000528"></a>

        <div class="method-heading">
          <a href="#M000528" class="method-signature">
          <span class="method-name">available_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000528-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000528-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 236</span>
236:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">available_columns</span>
237:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@available_columns</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@available_columns</span>
238:     <span class="ruby-ivar">@available_columns</span> = <span class="ruby-constant">Query</span>.<span class="ruby-identifier">available_columns</span>
239:     <span class="ruby-ivar">@available_columns</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">project</span> <span class="ruby-value">? </span>
240:                             <span class="ruby-identifier">project</span>.<span class="ruby-identifier">all_issue_custom_fields</span> <span class="ruby-operator">:</span>
241:                             <span class="ruby-constant">IssueCustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
242:                            ).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cf</span><span class="ruby-operator">|</span> <span class="ruby-constant">QueryCustomFieldColumn</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cf</span>) }      
243:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000521" class="method-detail">
        <a name="M000521"></a>

        <div class="method-heading">
          <a href="#M000521" class="method-signature">
          <span class="method-name">available_filters</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000521-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000521-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 148</span>
148:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">available_filters</span>
149:     <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@available_filters</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@available_filters</span>
150:     
151:     <span class="ruby-identifier">trackers</span> = <span class="ruby-identifier">project</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span><span class="ruby-constant">Tracker</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'position'</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">rolled_up_trackers</span>
152:     
153:     <span class="ruby-ivar">@available_filters</span> = { <span class="ruby-value str">&quot;status_id&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list_status</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">IssueStatus</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'position'</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } },       
154:                            <span class="ruby-value str">&quot;tracker_id&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">trackers</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } },                                                                                                                
155:                            <span class="ruby-value str">&quot;priority_id&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">IssuePriority</span>.<span class="ruby-identifier">all</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } },
156:                            <span class="ruby-value str">&quot;subject&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:text</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">8</span> },  
157:                            <span class="ruby-value str">&quot;created_on&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:date_past</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span> },                        
158:                            <span class="ruby-value str">&quot;updated_on&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:date_past</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> },
159:                            <span class="ruby-value str">&quot;start_date&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:date</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">11</span> },
160:                            <span class="ruby-value str">&quot;due_date&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:date</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">12</span> },
161:                            <span class="ruby-value str">&quot;estimated_hours&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">13</span> },
162:                            <span class="ruby-value str">&quot;done_ratio&quot;</span> =<span class="ruby-operator">&gt;</span>  { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">14</span> }}
163:     
164:     <span class="ruby-identifier">user_values</span> = []
165:     <span class="ruby-identifier">user_values</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-node">&quot;&lt;&lt; #{l(:label_me)} &gt;&gt;&quot;</span>, <span class="ruby-value str">&quot;me&quot;</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">logged?</span>
166:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span>
167:       <span class="ruby-identifier">user_values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">users</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] }
168:     <span class="ruby-keyword kw">else</span>
169:       <span class="ruby-comment cmt"># members of the user's projects</span>
170:       <span class="ruby-identifier">user_values</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:users</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] }
171:     <span class="ruby-keyword kw">end</span>
172:     <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;assigned_to_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list_optional</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_values</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">user_values</span>.<span class="ruby-identifier">empty?</span>
173:     <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;author_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">user_values</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">user_values</span>.<span class="ruby-identifier">empty?</span>
174:     
175:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">logged?</span>
176:       <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;watcher_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">15</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> [[<span class="ruby-node">&quot;&lt;&lt; #{l(:label_me)} &gt;&gt;&quot;</span>, <span class="ruby-value str">&quot;me&quot;</span>]] }
177:     <span class="ruby-keyword kw">end</span>
178:   
179:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span>
180:       <span class="ruby-comment cmt"># project specific filters</span>
181:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">issue_categories</span>.<span class="ruby-identifier">empty?</span>
182:         <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;category_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list_optional</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">6</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">issue_categories</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } }
183:       <span class="ruby-keyword kw">end</span>
184:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">versions</span>.<span class="ruby-identifier">empty?</span>
185:         <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;fixed_version_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list_optional</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">7</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">versions</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } }
186:       <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">descendants</span>.<span class="ruby-identifier">active</span>.<span class="ruby-identifier">empty?</span>
188:         <span class="ruby-ivar">@available_filters</span>[<span class="ruby-value str">&quot;subproject_id&quot;</span>] = { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:list_subprojects</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">13</span>, <span class="ruby-identifier">:values</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@project</span>.<span class="ruby-identifier">descendants</span>.<span class="ruby-identifier">visible</span>.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>] } }
189:       <span class="ruby-keyword kw">end</span>
190:       <span class="ruby-identifier">add_custom_fields_filters</span>(<span class="ruby-ivar">@project</span>.<span class="ruby-identifier">all_issue_custom_fields</span>)
191:     <span class="ruby-keyword kw">else</span>
192:       <span class="ruby-comment cmt"># global filters for cross project issue list</span>
193:       <span class="ruby-identifier">add_custom_fields_filters</span>(<span class="ruby-constant">IssueCustomField</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:is_filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:is_for_all</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}))
194:     <span class="ruby-keyword kw">end</span>
195:     <span class="ruby-ivar">@available_filters</span>
196:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000531" class="method-detail">
        <a name="M000531"></a>

        <div class="method-heading">
          <a href="#M000531" class="method-signature">
          <span class="method-name">column_names=</span><span class="method-args">(names)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000531-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000531-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">column_names=</span>(<span class="ruby-identifier">names</span>)
263:     <span class="ruby-identifier">names</span> = <span class="ruby-identifier">names</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">n</span>.<span class="ruby-identifier">blank?</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">names</span>
264:     <span class="ruby-identifier">names</span> = <span class="ruby-identifier">names</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_sym</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">names</span>
265:     <span class="ruby-identifier">write_attribute</span>(<span class="ruby-identifier">:column_names</span>, <span class="ruby-identifier">names</span>)
266:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000530" class="method-detail">
        <a name="M000530"></a>

        <div class="method-heading">
          <a href="#M000530" class="method-signature">
          <span class="method-name">columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000530-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000530-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">columns</span>
251:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">has_default_columns?</span>
252:       <span class="ruby-identifier">available_columns</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
253:         <span class="ruby-comment cmt"># Adds the project column by default for cross-project lists</span>
254:         <span class="ruby-constant">Setting</span>.<span class="ruby-identifier">issue_list_default_columns</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:project</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">nil?</span>)
255:       <span class="ruby-keyword kw">end</span>
256:     <span class="ruby-keyword kw">else</span>
257:       <span class="ruby-comment cmt"># preserve the column_names order</span>
258:       <span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">available_columns</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">col</span><span class="ruby-operator">|</span> <span class="ruby-identifier">col</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>}}.<span class="ruby-identifier">compact</span>
259:     <span class="ruby-keyword kw">end</span>
260:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000520" class="method-detail">
        <a name="M000520"></a>

        <div class="method-heading">
          <a href="#M000520" class="method-signature">
          <span class="method-name">editable_by?</span><span class="method-args">(user)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000520-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000520-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 140</span>
140:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">editable_by?</span>(<span class="ruby-identifier">user</span>)
141:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">user</span>
142:     <span class="ruby-comment cmt"># Admin can edit them all and regular users can edit their private queries</span>
143:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">admin?</span> <span class="ruby-operator">||</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">user_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">id</span>)
144:     <span class="ruby-comment cmt"># Members can not edit public queries that are for all project (only admin is allowed to)</span>
145:     <span class="ruby-identifier">is_public</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@is_for_all</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">allowed_to?</span>(<span class="ruby-identifier">:manage_public_queries</span>, <span class="ruby-identifier">project</span>)
146:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000540" class="method-detail">
        <a name="M000540"></a>

        <div class="method-heading">
          <a href="#M000540" class="method-signature">
          <span class="method-name">group_by_column</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000540-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000540-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 311</span>
311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">group_by_column</span>
312:     <span class="ruby-identifier">groupable_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">group_by</span>}
313:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000538" class="method-detail">
        <a name="M000538"></a>

        <div class="method-heading">
          <a href="#M000538" class="method-signature">
          <span class="method-name">group_by_sort_order</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the SQL sort order that should be prepended for grouping
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000538-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000538-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 298</span>
298:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">group_by_sort_order</span>
299:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">grouped?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">column</span> = <span class="ruby-identifier">group_by_column</span>)
300:       <span class="ruby-identifier">column</span>.<span class="ruby-identifier">sortable</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span>
301:         <span class="ruby-identifier">column</span>.<span class="ruby-identifier">sortable</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{s} #{column.default_order}&quot;</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>) <span class="ruby-operator">:</span>
302:         <span class="ruby-node">&quot;#{column.sortable} #{column.default_order}&quot;</span>
303:     <span class="ruby-keyword kw">end</span>
304:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000529" class="method-detail">
        <a name="M000529"></a>

        <div class="method-heading">
          <a href="#M000529" class="method-signature">
          <span class="method-name">groupable_columns</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="Query.html#M000530">columns</a> that can be
used to group the results
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000529-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000529-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">groupable_columns</span>
247:     <span class="ruby-identifier">available_columns</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">groupable</span>}
248:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000539" class="method-detail">
        <a name="M000539"></a>

        <div class="method-heading">
          <a href="#M000539" class="method-signature">
          <span class="method-name">grouped?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the query is a grouped query
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000539-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000539-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 307</span>
307:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">grouped?</span>
308:     <span class="ruby-operator">!</span><span class="ruby-identifier">group_by</span>.<span class="ruby-identifier">blank?</span>
309:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000532" class="method-detail">
        <a name="M000532"></a>

        <div class="method-heading">
          <a href="#M000532" class="method-signature">
          <span class="method-name">has_column?</span><span class="method-args">(column)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000532-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000532-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_column?</span>(<span class="ruby-identifier">column</span>)
269:     <span class="ruby-identifier">column_names</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">column</span>.<span class="ruby-identifier">name</span>)
270:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000533" class="method-detail">
        <a name="M000533"></a>

        <div class="method-heading">
          <a href="#M000533" class="method-signature">
          <span class="method-name">has_default_columns?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000533-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000533-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 272</span>
272:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_default_columns?</span>
273:     <span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">empty?</span>
274:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000524" class="method-detail">
        <a name="M000524"></a>

        <div class="method-heading">
          <a href="#M000524" class="method-signature">
          <span class="method-name">has_filter?</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000524-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000524-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 219</span>
219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_filter?</span>(<span class="ruby-identifier">field</span>)
220:     <span class="ruby-identifier">filters</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">field</span>]
221:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000527" class="method-detail">
        <a name="M000527"></a>

        <div class="method-heading">
          <a href="#M000527" class="method-signature">
          <span class="method-name">label_for</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000527-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000527-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">label_for</span>(<span class="ruby-identifier">field</span>)
232:     <span class="ruby-identifier">label</span> = <span class="ruby-identifier">available_filters</span>[<span class="ruby-identifier">field</span>][<span class="ruby-identifier">:name</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">available_filters</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">field</span>)
233:     <span class="ruby-identifier">label</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\_id$/</span>, <span class="ruby-value str">&quot;&quot;</span>)
234:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000525" class="method-detail">
        <a name="M000525"></a>

        <div class="method-heading">
          <a href="#M000525" class="method-signature">
          <span class="method-name">operator_for</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000525-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000525-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">operator_for</span>(<span class="ruby-identifier">field</span>)
224:     <span class="ruby-identifier">has_filter?</span>(<span class="ruby-identifier">field</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">field</span>][<span class="ruby-identifier">:operator</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000541" class="method-detail">
        <a name="M000541"></a>

        <div class="method-heading">
          <a href="#M000541" class="method-signature">
          <span class="method-name">project_statement</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000541-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000541-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">project_statement</span>
316:     <span class="ruby-identifier">project_clauses</span> = []
317:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@project</span>.<span class="ruby-identifier">descendants</span>.<span class="ruby-identifier">active</span>.<span class="ruby-identifier">empty?</span>
318:       <span class="ruby-identifier">ids</span> = [<span class="ruby-identifier">project</span>.<span class="ruby-identifier">id</span>]
319:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">has_filter?</span>(<span class="ruby-value str">&quot;subproject_id&quot;</span>)
320:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">operator_for</span>(<span class="ruby-value str">&quot;subproject_id&quot;</span>)
321:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'='</span>
322:           <span class="ruby-comment cmt"># include the selected subprojects</span>
323:           <span class="ruby-identifier">ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">values_for</span>(<span class="ruby-value str">&quot;subproject_id&quot;</span>).<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:to_i</span>)
324:         <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'!*'</span>
325:           <span class="ruby-comment cmt"># main project only</span>
326:         <span class="ruby-keyword kw">else</span>
327:           <span class="ruby-comment cmt"># all subprojects</span>
328:           <span class="ruby-identifier">ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">descendants</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>)
329:         <span class="ruby-keyword kw">end</span>
330:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">Setting</span>.<span class="ruby-identifier">display_subprojects_issues?</span>
331:         <span class="ruby-identifier">ids</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">descendants</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>)
332:       <span class="ruby-keyword kw">end</span>
333:       <span class="ruby-identifier">project_clauses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Project.table_name}.id IN (%s)&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">','</span>)
334:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">project</span>
335:       <span class="ruby-identifier">project_clauses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Project.table_name}.id = %d&quot;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">project</span>.<span class="ruby-identifier">id</span>
336:     <span class="ruby-keyword kw">end</span>
337:     <span class="ruby-identifier">project_clauses</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-constant">Project</span>.<span class="ruby-identifier">allowed_to_condition</span>(<span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>, <span class="ruby-identifier">:view_issues</span>)
338:     <span class="ruby-identifier">project_clauses</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' AND '</span>)
339:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000535" class="method-detail">
        <a name="M000535"></a>

        <div class="method-heading">
          <a href="#M000535" class="method-signature">
          <span class="method-name">sort_criteria</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000535-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000535-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 285</span>
285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sort_criteria</span>
286:     <span class="ruby-identifier">read_attribute</span>(<span class="ruby-identifier">:sort_criteria</span>) <span class="ruby-operator">||</span> []
287:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000534" class="method-detail">
        <a name="M000534"></a>

        <div class="method-heading">
          <a href="#M000534" class="method-signature">
          <span class="method-name">sort_criteria=</span><span class="method-args">(arg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000534-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000534-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sort_criteria=</span>(<span class="ruby-identifier">arg</span>)
277:     <span class="ruby-identifier">c</span> = []
278:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
279:       <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span>[<span class="ruby-identifier">k</span>]}
280:     <span class="ruby-keyword kw">end</span>
281:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">blank?</span>}.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">3</span>).<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">o</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">o</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'desc'</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">o</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'asc'</span>]}
282:     <span class="ruby-identifier">write_attribute</span>(<span class="ruby-identifier">:sort_criteria</span>, <span class="ruby-identifier">c</span>)
283:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000536" class="method-detail">
        <a name="M000536"></a>

        <div class="method-heading">
          <a href="#M000536" class="method-signature">
          <span class="method-name">sort_criteria_key</span><span class="method-args">(arg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000536-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000536-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 289</span>
289:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sort_criteria_key</span>(<span class="ruby-identifier">arg</span>)
290:     <span class="ruby-identifier">sort_criteria</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sort_criteria</span>[<span class="ruby-identifier">arg</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sort_criteria</span>[<span class="ruby-identifier">arg</span>].<span class="ruby-identifier">first</span>
291:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000537" class="method-detail">
        <a name="M000537"></a>

        <div class="method-heading">
          <a href="#M000537" class="method-signature">
          <span class="method-name">sort_criteria_order</span><span class="method-args">(arg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000537-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000537-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 293</span>
293:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sort_criteria_order</span>(<span class="ruby-identifier">arg</span>)
294:     <span class="ruby-identifier">sort_criteria</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sort_criteria</span>[<span class="ruby-identifier">arg</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">sort_criteria</span>[<span class="ruby-identifier">arg</span>].<span class="ruby-identifier">last</span>
295:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000542" class="method-detail">
        <a name="M000542"></a>

        <div class="method-heading">
          <a href="#M000542" class="method-signature">
          <span class="method-name">statement</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000542-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000542-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 341</span>
341:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">statement</span>
342:     <span class="ruby-comment cmt"># filters clauses</span>
343:     <span class="ruby-identifier">filters_clauses</span> = []
344:     <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
345:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;subproject_id&quot;</span>
346:       <span class="ruby-identifier">v</span> = <span class="ruby-identifier">values_for</span>(<span class="ruby-identifier">field</span>).<span class="ruby-identifier">clone</span>
347:       <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">empty?</span>
348:       <span class="ruby-identifier">operator</span> = <span class="ruby-identifier">operator_for</span>(<span class="ruby-identifier">field</span>)
349:       
350:       <span class="ruby-comment cmt"># &quot;me&quot; value subsitution</span>
351:       <span class="ruby-keyword kw">if</span> <span class="ruby-node">%w(assigned_to_id author_id watcher_id)</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">field</span>)
352:         <span class="ruby-identifier">v</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">logged?</span> <span class="ruby-value">? </span><span class="ruby-constant">User</span>.<span class="ruby-identifier">current</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;0&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;me&quot;</span>)
353:       <span class="ruby-keyword kw">end</span>
354:       
355:       <span class="ruby-identifier">sql</span> = <span class="ruby-value str">''</span>
356:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^cf_(\d+)$/</span>
357:         <span class="ruby-comment cmt"># custom field</span>
358:         <span class="ruby-identifier">db_table</span> = <span class="ruby-constant">CustomValue</span>.<span class="ruby-identifier">table_name</span>
359:         <span class="ruby-identifier">db_field</span> = <span class="ruby-value str">'value'</span>
360:         <span class="ruby-identifier">is_custom_filter</span> = <span class="ruby-keyword kw">true</span>
361:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Issue.table_name}.id IN (SELECT #{Issue.table_name}.id FROM #{Issue.table_name} LEFT OUTER JOIN #{db_table} ON #{db_table}.customized_type='Issue' AND #{db_table}.customized_id=#{Issue.table_name}.id AND #{db_table}.custom_field_id=#{$1} WHERE &quot;</span>
362:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sql_for_field</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">v</span>, <span class="ruby-identifier">db_table</span>, <span class="ruby-identifier">db_field</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">')'</span>
363:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">field</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'watcher_id'</span>
364:         <span class="ruby-identifier">db_table</span> = <span class="ruby-constant">Watcher</span>.<span class="ruby-identifier">table_name</span>
365:         <span class="ruby-identifier">db_field</span> = <span class="ruby-value str">'user_id'</span>
366:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{Issue.table_name}.id #{ operator == '=' ? 'IN' : 'NOT IN' } (SELECT #{db_table}.watchable_id FROM #{db_table} WHERE #{db_table}.watchable_type='Issue' AND &quot;</span>
367:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sql_for_field</span>(<span class="ruby-identifier">field</span>, <span class="ruby-value str">'='</span>, <span class="ruby-identifier">v</span>, <span class="ruby-identifier">db_table</span>, <span class="ruby-identifier">db_field</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">')'</span>
368:       <span class="ruby-keyword kw">else</span>
369:         <span class="ruby-comment cmt"># regular field</span>
370:         <span class="ruby-identifier">db_table</span> = <span class="ruby-constant">Issue</span>.<span class="ruby-identifier">table_name</span>
371:         <span class="ruby-identifier">db_field</span> = <span class="ruby-identifier">field</span>
372:         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'('</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sql_for_field</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">operator</span>, <span class="ruby-identifier">v</span>, <span class="ruby-identifier">db_table</span>, <span class="ruby-identifier">db_field</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">')'</span>
373:       <span class="ruby-keyword kw">end</span>
374:       <span class="ruby-identifier">filters_clauses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">sql</span>
375:       
376:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filters</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">valid?</span>
377:     
378:     (<span class="ruby-identifier">filters_clauses</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">project_statement</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">' AND '</span>)
379:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000519" class="method-detail">
        <a name="M000519"></a>

        <div class="method-heading">
          <a href="#M000519" class="method-signature">
          <span class="method-name">validate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000519-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000519-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 130</span>
130:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">validate</span>
131:     <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">each_key</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">field</span><span class="ruby-operator">|</span>
132:       <span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span> <span class="ruby-identifier">label_for</span>(<span class="ruby-identifier">field</span>), <span class="ruby-identifier">:blank</span> <span class="ruby-keyword kw">unless</span> 
133:           <span class="ruby-comment cmt"># filter requires one or more values</span>
134:           (<span class="ruby-identifier">values_for</span>(<span class="ruby-identifier">field</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">values_for</span>(<span class="ruby-identifier">field</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">blank?</span>) <span class="ruby-keyword kw">or</span> 
135:           <span class="ruby-comment cmt"># filter doesn't require any value</span>
136:           [<span class="ruby-value str">&quot;o&quot;</span>, <span class="ruby-value str">&quot;c&quot;</span>, <span class="ruby-value str">&quot;!*&quot;</span>, <span class="ruby-value str">&quot;*&quot;</span>, <span class="ruby-value str">&quot;t&quot;</span>, <span class="ruby-value str">&quot;w&quot;</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">operator_for</span>(<span class="ruby-identifier">field</span>)
137:     <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">filters</span>
138:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000526" class="method-detail">
        <a name="M000526"></a>

        <div class="method-heading">
          <a href="#M000526" class="method-signature">
          <span class="method-name">values_for</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000526-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000526-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/query.rb, line 227</span>
227:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">values_for</span>(<span class="ruby-identifier">field</span>)
228:     <span class="ruby-identifier">has_filter?</span>(<span class="ruby-identifier">field</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">field</span>][<span class="ruby-identifier">:values</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>
229:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>